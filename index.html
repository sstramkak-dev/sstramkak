<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green Drive Dashboard</title>
    <style>
        :root {
            --primary-green: #1EA647;
            --hover-green: #168a39;
            --bg-gray: #f4f7f6;
            --text-dark: #2d3436;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            display: flex;
            height: 100vh;
            background-color: var(--bg-gray);
            color: var(--text-dark);
        }

        /* --- Sidebar --- */
        .sidebar {
            width: 260px;
            background: white;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            padding: 30px 20px;
        }

        .sidebar h2 {
            color: var(--primary-green);
            margin-bottom: 40px;
            text-align: center;
        }

        .nav-btn {
            background: none;
            border: none;
            padding: 14px 20px;
            text-align: left;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 12px;
            margin-bottom: 10px;
            transition: 0.2s;
            color: #636e72;
        }

        .nav-btn.active {
            background-color: var(--primary-green);
            color: white;
        }

        /* --- Main Content --- */
        .main-content {
            flex-grow: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .content-section { display: none; }
        .content-section.active { display: block; }

        .card {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }

        .balance-card {
            background: var(--primary-green);
            color: white;
            max-width: 300px;
        }

        /* --- Table & Forms --- */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; padding: 12px; color: #b2bec3; font-size: 12px; text-transform: uppercase; border-bottom: 2px solid #f4f7f6; }
        td { padding: 12px; border-bottom: 1px solid #f4f7f6; }

        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
        }

        .submit-btn {
            background: var(--primary-green);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
        }

        /* --- Debugger --- */
        #debug-box {
            background: #2d3436;
            color: #fab1a0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 50px;
            display: none;
        }
    </style>
</head>
<body>

    <nav class="sidebar">
        <h2>GreenDash</h2>
        <button class="nav-btn active" onclick="showSection('deposit', this)">Deposit</button>
        <button class="nav-btn" onclick="showSection('settings', this)">Settings</button>
    </nav>

    <main class="main-content">
        
        <div id="deposit" class="content-section active">
            <div class="card balance-card">
                <small>Total Balance</small>
                <h1 id="totalBalance">$0.00</h1>
            </div>

            <div style="display: flex; gap: 25px; flex-wrap: wrap;">
                <div class="card" style="flex: 1; min-width: 300px;">
                    <h1>New Deposit</h1>
                    <label>Amount ($)</label>
                    <input type="number" id="depositAmount" placeholder="Enter amount">
                    <button class="submit-btn" onclick="sendToDrive()">Save to Drive</button>
                    <p id="status" style="font-size: 14px; text-align: center;"></p>
                </div>

                <div class="card" style="flex: 2; min-width: 400px;">
                    <h1>Recent Transactions</h1>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr><td colspan="2">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="settings" class="content-section">
            <div class="card">
                <h1>Settings</h1>
                <p>Dashboard is connected to Google Drive via Apps Script.</p>
                <button class="submit-btn" style="width: auto;" onclick="toggleDebug()">Toggle Debug Mode</button>
            </div>
        </div>

        <div id="debug-box">
            <strong>System Logs:</strong><br>
            <span id="log-content">Waiting for action...</span>
        </div>
    </main>

    <script>
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbx0TSw5-WUwA60UpgxYrF_DQqiUsSTdH39wJS9_uiXqWrpb2a58ZVIdYdnk9wO4QSUcvA/exec";

        function showSection(sectionId, btn) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            btn.classList.add('active');
        }

        function log(msg) {
            document.getElementById('log-content').innerText = msg;
            console.log(msg);
        }

        function toggleDebug() {
            const box = document.getElementById('debug-box');
            box.style.display = box.style.display === 'none' ? 'block' : 'none';
        }

        async function sendToDrive() {
            const amount = document.getElementById('depositAmount').value;
            const status = document.getElementById('status');
            if (!amount) return;

            status.innerText = "⏳ Uploading...";
            log("Attempting POST to: " + WEB_APP_URL);

            try {
                await fetch(WEB_APP_URL, {
                    method: "POST",
                    mode: "no-cors",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        type: "Deposit",
                        amount: amount,
                        timestamp: new Date().toISOString()
                    })
                });

                status.innerText = "✅ Saved to Drive!";
                document.getElementById('depositAmount').value = "";
                setTimeout(loadTransactions, 2000);
            } catch (err) {
                log("POST Error: " + err.message);
                status.innerText = "❌ Error. Check Debug Console.";
            }
        }

        async function loadTransactions() {
            log("Fetching transactions...");
            try {
                const response = await fetch(WEB_APP_URL);
                if (!response.ok) throw new Error("Status " + response.status);
                
                const data = await response.json();
                const tableBody = document.getElementById('tableBody');
                const balanceEl = document.getElementById('totalBalance');
                
                tableBody.innerHTML = "";
                let total = 0;

                data.forEach(item => {
                    total += parseFloat(item.amount);
                    const row = `<tr>
                        <td>${new Date(item.timestamp).toLocaleDateString()}</td>
                        <td style="font-weight:bold; color:var(--primary-green)">$${parseFloat(item.amount).toLocaleString()}</td>
                    </tr>`;
                    tableBody.innerHTML += row;
                });

                balanceEl.innerText = `$${total.toLocaleString()}`;
                log("Data loaded successfully.");
            } catch (err) {
                log("GET Error: " + err.message);
                document.getElementById('tableBody').innerHTML = "<tr><td colspan='2' style='color:red'>Permission Error. Check Apps Script Deployment.</td></tr>";
            }
        }

        window.onload = loadTransactions;
    </script>
</body>
</html>